<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../paper-input/paper-input.html">

<dom-module id="single-element">
  <template>
    <style>
      :host {
        display: block;
      }
      #hr1 {
        margin-bottom: 30px;
        position:relative;
        top:-12px;
      }

       #filter {
        /* background: red; */
        border: none;
        margin-bottom:6px;
        position: relative;
         display:inline-block;
         width:100%;
         height: 20px;
         outline:none;
      }

      #tari {
        border: none;
        width: 560px;
          position:absolute;
          background-color:whitesmoke ;
        display:none;
        z-index: 100;
        cursor:pointer;
      }

      .arrow-left {
        width: 0;
        height: 0;
        border-top: 5px solid transparent;
        border-bottom: 5px solid transparent;
        border-right:10px solid black;
        z-index:1;
        position: absolute;
        right: 12px;
        top: -24px;
        transition: transform 0.5s;
      }

      .linieSpeciala{
        width: 0px;
        height: 2px;
        background: #0066bb;
        transition: width 0.5s, left 0.5s;
        position: absolute;
        left:50%;
        top: -12px;
        z-index: 2;
      }
      .spanPrincipal{
        position:absolute;
        background-color:#c0c0c0;
        border-radius:8px;
        display:inline-block;
        width:90px;
        height:20px;
          z-index: 1;


      }
      .delete {
        width: 24px;
        height: 20px;
        border: solid black 1px;
        position:absolute;
        left:65px;
        z-index:2;
        cursor:pointer;
      }

    </style>

      <span class="scrisMic">Tara</span>
      <div id="container" style="position:relative;">
      </div>

        <input id="filter" type="text" for="tari" on-input="filter" on-focus="displayBlock" on-keydown="keyCode" on-blur="displayNone" />
        <div style="position:relative;">
             <div class="arrow-left"></div>
             </div>
             <div id="tari" for="spanPrincipal" on-mouseover="changeColor" on-mouseout="colorBack">
             </div>
         <div style="position:relative;">
             <div class="linieSpeciala" id="linieSpeciala"></div>

               <hr id="hr1" >
           </div>

       </template>

       <script>
         /**
          * `single-element`
          *
          *
          * @customElement
          * @polymer
          * @demo demo/index.html
          */
         class SingleElement extends Polymer.Element {
             static get is() {
                 return 'single-element';
             }

             static get properties() {
                 return {
                     prop1: {
                         type: String,
                         value: 'single-element'

                     },
                     indexTabel: {
                         type: Number,
                         value: -1
                     },

                     options1: {
                         type: Array,
                         value: [
                             "Romania",
                             "Italia",
                             "Franta",
                             "Germania",
                             "Spania"
                         ]
                     },

                 };
             }

             connectedCallback() {
                 super.connectedCallback();

                 this.options1.sort(
                     function(a,b){
                         return a.toLowerCase().localeCompare(b.toLowerCase());
                     }
                 );

                 var str = "";
                 for (let i = 0; i < this.options1.length; i++) {
                     str  = str + "<div>" + this.options1[i] + "</div>";
                 }
                 this.$.tari.innerHTML = str;
                 var optiuni = this.$.tari.querySelectorAll("div");
                 for(let i = 0 ; i < optiuni.length ; i++) {

                     optiuni[i].addEventListener("click", function (event){
                         this.selectFunction(event);
                     }.bind(this));
                 }
             }

             displayNone(event){
                 setTimeout(function(){
                     this.$[event.path[0].getAttribute("for")].style.display="none";
                     this.$.linieSpeciala.style.width="0%";
                     this.$.linieSpeciala.style.left="50%";
                 }.bind(this),100)
                 event.path[1].querySelector(".arrow-left").style.transform="rotate(0deg)";


             }


             displayBlock(event){
                 this.$[event.path[0].getAttribute("for")].style.display = "block";
                        console.log(event.path[0].getAttribute("for"));
                        if(this.indexTabel !== -1){
                            event.path[0].parentNode.querySelector("#tari div:nth-of-type(" + (this.indexTabel+1) + ")").style.backgroundColor = "whitesmoke";
                        }
                      if(event.path[0].id === "filter") {
                          this.$.linieSpeciala.style.width = "100%";
                          this.$.linieSpeciala.style.left = "0%";
                     }
                     if(event.path[0].id === "filter" ) {
                         this.indexTabel=-1;
                         event.path[1].querySelector(".arrow-left").style.transform = "rotate(-90deg)";
                     }
             }


             changeColor(event){

                 for(let i = 0; i < this.options1.length; i++){
                     if(event.path[0].innerHTML === this.options1[i] ){
                         if(this.indexTabel !== -1) {
                             event.path[0].parentNode.querySelector("#tari div:nth-of-type(" + (this.indexTabel + 1) + ")").style.backgroundColor = "";
                         }
                         event.path[0].style.backgroundColor  = "darkgrey";
                         this.indexTabel = i;
                    }
                }

             }

             colorBack(event){
                     event.path[0].style.backgroundColor = "whitesmoke";
             }

            keyCode(event){
                var key = event.which || event.keyCode;

                    if (key === 40) {
                        this.indexTabel++;
                        if(this.indexTabel >= this.options1.length ){
                            this.indexTabel = 0;
                        }
                        event.path[0].parentNode.querySelector("#tari div:nth-of-type("+ (this.indexTabel+1)+")").style.backgroundColor  = "darkgrey";
                        if(this.indexTabel>0){
                            event.path[0].parentNode.querySelector("#tari div:nth-of-type(" + (this.indexTabel) + ")").style.backgroundColor = "";
                        }
                        if(this.indexTabel === 0){
                            event.path[0].parentNode.querySelector("#tari div:nth-of-type(" + (this.options1.length) + ")").style.backgroundColor = "";
                        }

                    }
                    if (key === 38) {
                        event.path[0].parentNode.querySelector("#tari").style.backgroundColor  = "whitesmoke";
                        this.indexTabel--;
                        if(this.indexTabel < 0){
                            this.indexTabel=this.options1.length-1;
                        }
                        event.path[0].parentNode.querySelector("#tari div:nth-of-type("+ (this.indexTabel+1)+")").style.backgroundColor  = "darkgrey";
                        if(this.indexTabel <4) {
                            event.path[0].parentNode.querySelector("#tari div:nth-of-type(" + (this.indexTabel + 2) + ")").style.backgroundColor = "";
                        }
                        if(this.indexTabel === this.options1.length-1){
                            event.path[0].parentNode.querySelector("#tari div:nth-of-type(" + 1 + ")").style.backgroundColor = "";
                        }
                    }
                    if (key === 13){
                       this.selectFunction({
                            path:[
                                event.path[0].parentNode.querySelector("#tari div:nth-of-type(" + (this.indexTabel+1) + ")")
                            ]
                        });
                        event.path[0].parentNode.querySelector("#tari").style.display = "none";
                        this.$.linieSpeciala.style.width="0%";
                        this.$.linieSpeciala.style.left="50%";
                    }
            }

             filter() {
                 var val = this.$.filter.value;
                 this.$.tari.innerHTML = "";
                 for (let i = 0; i < this.options1.length; i++) {
                     if (this.options1[i].toLowerCase().indexOf(val.toLowerCase()) !== -1) {
                         this.$.tari.innerHTML += "<div>" + this.options1[i] + "</div>";
                     }
                 }
             }
             selectFunction(event){
                        this.$.container.innerHTML = `
                    <span class="spanPrincipal" for="spanPrincipal" >
                        <span id="spanPrincipal" style="padding-left: 5px;">${event.path[0].innerHTML}</span>
                        <button class="delete" type="button">X</button>
                    </span>`;

                 var deleteAll = this.$.container.querySelectorAll(".delete");
                 for(let i = 0; i < deleteAll.length; i++) {
                     deleteAll[i].addEventListener("click", function (event) {
                         this.parentNode.remove(i-1);
                     });
                 }
             }




         }

         window.customElements.define(SingleElement.is, SingleElement);
       </script>
     </dom-module>
